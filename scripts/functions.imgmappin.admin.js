var easy2map_imgmappin_functions=(function(){clearPinArray=function(){if($pinsArray){for(i in $pinsArray){$pinsArray[i].setMap(null);$pinsArray[i].setAnimation(null)}}if($pinsArray){$pinsArray.length=0}$selectedPin=null};addPinToMap=function(a){this.selectedMapPoint=a;var b=new google.maps.Marker({position:new google.maps.LatLng(this.selectedMapPoint.lattitude,this.selectedMapPoint.longitude),draggable:true,map:$map,title:this.selectedMapPoint.title.replace(/\\/gi,""),ID:this.selectedMapPoint.ID,icon:this.selectedMapPoint.icon,settings:this.selectedMapPoint.settings,small:this.selectedMapPoint.small,medium:this.selectedMapPoint.medium,large:this.selectedMapPoint.large,pinHTML:this.selectedMapPoint.pinhtml,pinText:this.selectedMapPoint.pintext,visible:false});$pinsArray.push(b);google.maps.event.addListener(b,"dragend",function(c){$latlng=c.latLng;showLatLong();updateMapPinLocation(b.ID)});google.maps.event.addListener(b,"click",function(f){var d="";var c=b.pinHTML.split("\n");for(var e=0;e<c.length;e++){if(e>0){d+="<br>"}d+=c[e]}})};clearTextOfAllFormatting=function(a){a=replaceAll(a,"&quot;Arial&quot;","Arial");a=replaceAll(a,"&quot;Times New Roman&quot;","Arial");a=replaceAll(a,"&quot;sans-serif&quot;","sans-serif");a=replaceAll(a,'class="MsoNormal"',"");a=a.replace(/ â€“ /g," - ");a=replaceAll(a,"line-height:","min-height:");if(a.indexOf("<p")!=-1){a=replaceAll(a,"'","&#39;")}a=replaceAll(a,"<p>",'<p style="margin:0; padding:0;">');a=replaceAll(a,'<p style="text-align: left;">','<p style="text-align: left;margin:0; padding:0;">');a=replaceAll(a,'<p style="text-align: right;">','<p style="text-align: left;margin:0; padding:0;">');a=replaceAll(a,'<p style="text-align: center;">','<p style="text-align: left;margin:0; padding:0;">');if(a.indexOf("[endif]")!=-1){a=a.substring(a.lastIndexOf("[endif]")+10)}return a};listedMapPin=function(a){this.pinDetails=a};setPinImage=function(a){jQuery("#draggable").attr("src",jQuery(a).attr("src"));jQuery("#mapPinIconList").modal("hide");if($pinsArray){for(i in $pinsArray){if(!!$selectedPin==false){continue}if(typeof $pinsArray[i].ID=="undefined"||typeof $selectedPin.ID=="undefined"){continue}if($pinsArray[i].ID==$selectedPin.ID){$pinsArray[i].setIcon(jQuery(a).attr("src"))}}}};showLatLong=function(){jQuery("#latLongParent").show();jQuery("#divLatLong").html("Position of Pin: "+$latlng)};updateMapPinLocation=function(a){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapPointID:a,latLong:$latlng+"",action:"e2m_img_update_map_pin_location"}})};return{addNewMapMarker:function(){jQuery("#AddMarkerOrSave").hide();jQuery("#tblAddMapMarker").show()},cancelSaveMapPin:function(){jQuery("#pinDescriptionParent").hide();jQuery("#divAddressSearch").hide();jQuery("#divDrag").hide();jQuery("#divDrag2").hide();jQuery("#btnCancelPin").hide();jQuery("#pinImageUploadParent").show();jQuery("#pinImageParent").hide();jQuery("#AddMarkerOrSave").hide();jQuery("#tblAddMapMarker").hide();jQuery("#address").attr("placeholder","Enter address where this picture was taken");document.getElementById("MapTemplateName").style.visibility="visible";var a=!!jQuery("#photoSize").attr("proVersion");if(a==false){document.getElementById("mapSize").style.visibility="hidden";document.getElementById("photoSize").style.visibility="hidden";document.getElementById("mapType").style.visibility="hidden";document.getElementById("markerZoom").style.visibility="hidden"}else{document.getElementById("mapSize").style.visibility="visible";document.getElementById("photoSize").style.visibility="visible";document.getElementById("mapType").style.visibility="visible";document.getElementById("markerZoom").style.visibility="visible"}document.getElementById("easy2mapmainimage").style.backgroundImage="none";jQuery("#draganddrop").show();jQuery("#AddEditPinTitle").html("Add New Photo").show();jQuery("#divPinAddEditParent").hide();jQuery("#easy2mapslidertext").html("").hide();jQuery("#pinDescription").data("wysihtml5").editor.clear();jQuery("#btnDeletePin").hide();jQuery("#btnSavePin").hide();jQuery("#latLongParent").hide();jQuery("#draggable").attr("src",$mapSettings.DefaultPinImage);if($selectedPin){$selectedPin.setAnimation(null)}$selectedPin=null;easy2map_imgmappin_functions.setIconDraggable();jQuery("td [id ^= imageTd]").removeClass("highlighted");jQuery("td [id ^= nameTd]").removeClass("highlighted");if($pinsArray){for(i in $pinsArray){if($pinsArray[i].ID==0){$pinsArray[i].setMap(null);$pinsArray[i].setAnimation(null);$pinsArray[i].setVisible(false);$pinsArray.splice(i,1)}}}jQuery("tr [id ^=divPinInstructions]").show();jQuery("#draganddrop").show();$mapPinID=0},changeMapPinTemplate:function(){var a=parseInt(jQuery("#MapPinTemplateName").val());for(var b=0;b<$arrTemplates.length;b++){var c=$arrTemplates[b];if(parseInt(c.ID)==a){jQuery("#MapTemplateExampleImg").html(c.TemplateHTML)}}},deleteSelectedPoint:function(){if(!confirm("Are you sure you wish to delete this marker? This action is not reversible!")){return}jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{MapPointID:$mapPinID,action:"e2m_img_delete_map_point"},success:function(a){if(a.length>0){alert(a);return}clearPinArray();if($pinsArray){$pinsArray.length=0}easy2map_imgmappin_functions.retrieveMapPoints()},error:function(a,c,b){if(b.length>0){alert(b)}}})},editPinItem:function(b){for(i=0;i<$pinsArray.length;i++){$pinsArray[i].setVisible(false)}var a=$markersArray[b].pinDetails;$latlng=new google.maps.LatLng(a.lattitude,a.longitude);$selectedPin=$pinsArray[b];$selectedPin.setVisible(true);showLatLong();$selectedPin.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){$selectedPin.setAnimation(null)},1500);$map.setCenter($latlng);jQuery("td [id ^= imageTd]").removeClass("highlighted");jQuery("td [id ^= nameTd]").removeClass("highlighted");jQuery("#imageTd"+b).addClass("highlighted");jQuery("#nameTd"+b).addClass("highlighted");document.getElementById("mapSize").style.visibility="hidden";document.getElementById("photoSize").style.visibility="hidden";document.getElementById("mapType").style.visibility="hidden";document.getElementById("markerZoom").style.visibility="hidden";document.getElementById("MapTemplateName").style.visibility="hidden";jQuery("#pinDescriptionParent").show();jQuery("#divAddressSearch").show();jQuery("#address").attr("placeholder","Change Photo Marker's Location");jQuery("#AddMarkerOrSave").hide();jQuery("#tblAddMapMarker").show();jQuery("#pinImagePreview").attr("src",a.large);jQuery("#pinImageUploadParent").hide();jQuery("#draganddrop").hide();jQuery("#btnCancelPin").show();jQuery("#AddEditPinTitle").html("Edit Photo Details").show();jQuery("#btnUploadIcon").html("Change Icon");jQuery("#divDrag").hide();jQuery("#divPinAddEditParent").show();jQuery("#pinName").val(a.title.replace(/\\/gi,""));jQuery("#pinDescription").data("wysihtml5").editor.setValue(a.pintext);jQuery("#small").val(a.small);jQuery("#medium").val(a.medium);jQuery("#large").val(a.large);jQuery("#easy2mapmainimage").css({"background-image":"url("+a.large+")","background-repeat":"no-repeat","background-position":"center"}).fadeIn();jQuery("#easy2mapslidertext").html(a.pintext).show();$mapPinID=a.ID;jQuery("#btnDeletePin").show();jQuery("#btnSavePin").show();jQuery("tr [id ^=divPinInstructions]").hide();jQuery("#draggable").attr("src",a.icon);easy2map_imgmappin_functions.setIconNotDraggable();easy2map_imgmap_functions.disableHover()},hidePreviewPage:function(){jQuery("#divMultipleLocations").fadeOut()},imageNotSuccessfullyUploaded:function(){if(document.getElementById("pinimage").value!=""){jQuery("#photoUploadError").modal();notBusy()}},imageSuccessfullyUploaded:function(e,b,d,c,a){jQuery("#easy2mapmainimage").css({"background-image":"url("+d+")","background-repeat":"no-repeat","background-position":"center"});for(i=0;i<$pinsArray.length;i++){$pinsArray[i].setVisible(false)}jQuery("#small").val(e);jQuery("#medium").val(b);jQuery("#large").val(d);jQuery("#pinImageUploadParent").hide();document.getElementById("mapSize").style.visibility="hidden";document.getElementById("photoSize").style.visibility="hidden";document.getElementById("mapType").style.visibility="hidden";document.getElementById("markerZoom").style.visibility="hidden";document.getElementById("MapTemplateName").style.visibility="hidden";jQuery("#AddEditPinTitle").html("Specify Photo's Location");jQuery("#btnSavePin").hide();jQuery("#btnDeletePin").hide();jQuery("#btnCancelPin").show();jQuery("#divPinAddEditParent").show();$selectedPin=null;if(c===0&&a===0){jQuery("#divAddressSearch").show();jQuery("#divDrag").show();jQuery("#divDrag2").show()}else{easy2map_imgmappin_functions.SetPinPosition(c,a)}easy2map_imgmap_functions.disableHover();jQuery("#easy2mapslidertext").html("").hide();jQuery("#pinimage").val("");notBusy()},openImagesDirectory:function(a){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:$mapID,action:"e2m_img_retrieve_pin_icons"},success:function(e){jQuery("#tblPinImages").find("tr").remove();var b=0;for(var d=0;d<e.length;d++){if(b%6==0){var f=document.createElement("tr");document.getElementById("tblPinImages").appendChild(f)}var c=document.createElement("td");c.align="center";c.style.borderColor="#FFFFFF";c.style.padding="2px";if(e[d]==a){c.style.borderColor="#EBEBEB";c.style.borderWidth="2px";c.style.borderStyle="solid";c.style.borderRadius="3px"}var g=document.createElement("img");g.style.cursor="pointer";g.setAttribute("onClick","easy2map_imgmappin_functions.setMapPinImage(this)");g.src=e[d];c.appendChild(g);f.appendChild(c);b+=1}jQuery("#mapPinIconList").modal()},error:function(b,d,c){alert(c)}})},placePin:function(b,c){for(i=0;i<$pinsArray.length;i++){$pinsArray[i].setVisible(false)}var a=new google.maps.Marker({position:b,ID:0,draggable:true,bouncy:true,title:"Click on icon to edit details",map:$map,icon:jQuery("#draggable").attr("src")});$latlng=a.position;$pinsArray.push(a);$selectedPin=$pinsArray[$pinsArray.length-1];showLatLong();if(!!c){$selectedPin.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){$selectedPin.setAnimation(null)},1500)}jQuery("#pinDescriptionParent").show();jQuery("#divAddressSearch").hide();document.getElementById("mapSize").style.visibility="hidden";document.getElementById("photoSize").style.visibility="hidden";document.getElementById("mapType").style.visibility="hidden";document.getElementById("markerZoom").style.visibility="hidden";document.getElementById("MapTemplateName").style.visibility="hidden";jQuery("#draganddrop").hide();jQuery("#btnCancelPin").show();jQuery("#AddEditPinTitle").hide();jQuery("#btnUploadIcon").html("Change Icon");jQuery("#address").attr("placeholder","Change Marker's Location");jQuery("#divDrag").hide();jQuery("#divPinAddEditParent").show();jQuery("tr [id ^=divPinInstructions]").hide();jQuery("#pinDescription").focus();jQuery("#btnSavePin").show();easy2map_imgmappin_functions.setIconNotDraggable();google.maps.event.addListener(a,"dragend",function(d){$latlng=d.latLng;showLatLong()});google.maps.event.addListener(a,"click",function(d){$latlng=d.latLng;showLatLong()});easy2map_imgmap_functions.disableHover()},retrieveMapPoints:function(){busy();var a={action:"e2m_img_retrieve_map_points",MapID:$mapID};easy2map_imgmappin_functions.cancelSaveMapPin();easy2map_imgmap_functions.disableHover();jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",success:function(e){jQuery("#tblMapMarkers").show().find("tr").remove();jQuery("#Easy2MapSliderParent").show().find("li").remove();var c=false;if(typeof e=="undefined"||typeof e=="null"){c=true}if(!e){c=true}if(e.length==0){c=true}if(c){jQuery("#AddMarkerOrSave").hide();jQuery("#tblAddMapMarker").show();easy2mapimg_functions.noPinsLoaded();notBusy();return}else{jQuery("#AddMarkerOrSave").show();jQuery("#tblAddMapMarker").hide()}if($markersArray){$markersArray.length=0}clearPinArray();for(var q=0;q<e.length;q++){var o=replaceAll(replaceAll(replaceAll(e[q].LatLong," ",""),"(",""),")","").split(",");var r={lattitude:o[0],longitude:o[1],ID:e[q].ID,title:e[q].Title,icon:e[q].ImageURL,settings:e[q].Settings,small:e[q].PinImageSmall,medium:e[q].PinImageMedium,large:e[q].PinImageLarge,pinhtml:e[q].MapPinHTML,pintext:e[q].MapPinText};$markersArray.push(new listedMapPin(r))}var g=[];for(var j=0;j<$markersArray.length;j++){var h=$markersArray[j].pinDetails;addPinToMap(h);if(document.getElementById("Easy2MapSliderParent")){var p=document.createElement("li");p.className="easy2mapslide";p.setAttribute("sliderID",h.ID);p.setAttribute("onClick","easy2mapimg_functions.clickPinItem("+h.ID+")");document.getElementById("Easy2MapSliderParent").appendChild(p);g.push(h.medium)}var n=document.createElement("tr");document.getElementById("tblMapMarkers").appendChild(n);var f=document.createElement("td");f.id="imageTd"+j;f.align="center";f.style.textAlign="center";var d=document.createElement("img");d.style.cursor="pointer";d.setAttribute("onClick","easy2map_imgmappin_functions.editPinItem("+j+")");d.src=h.icon;f.style.minWidth="10px";f.style.verticalAlign="middle";f.appendChild(d);var s=document.createElement("td");s.id="imageTd2"+j;s.align="center";s.style.textAlign="center";var k=document.createElement("img");k.border="1px solid #EBEBEB";k.style.cursor="pointer";k.setAttribute("onClick","easy2map_imgmappin_functions.editPinItem("+j+")");k.src=h.medium;s.title=h.title.replace(/\\/gi,"");s.appendChild(k);s.style.width="60%";var l=document.createElement("td");l.id="editTd"+j;l.style.minWidth="10%";l.style.textAlign="center";var b=document.createElement("a");b.innerText="edit";b.textContent="edit";b.href="#";b.setAttribute("className","smallE2MLink");b.setAttribute("onclick","easy2map_imgmappin_functions.editPinItem("+j+")");l.appendChild(b);n.appendChild(f);n.appendChild(s);n.appendChild(l)}if(g.length>0){jQuery.preloadImages(g,function m(){jQuery("#easy2mapslider").imgSlider(g)})}jQuery("#tblMapMarkers").removeClass("table-striped").addClass("table-striped");jQuery("#Easy2MapSliderParent li:first").each(function(){easy2mapimg_functions.clickPinItem(jQuery(this).attr("sliderID"))});if($markersArray.length>1){easy2map_imgmap_functions.enableHover()}else{jQuery("#easy2mapslider").hide()}notBusy()},error:function(b,d,c){notBusy()}})},saveMapPin:function(){var b=clearTextOfAllFormatting(jQuery("#pinDescription").val());var a="<div style='padding:3px;margin:5px;border:1px solid #EBEBEB' align='center'><img src='"+jQuery("#large").val()+"'>";if(b.length>0){a+="<div style='text-align:left;margin:0px;padding:0px;'>"+b+"</div>"}a+="</div>";busy();jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapPointID:$mapPinID,action:"e2m_img_save_map_pin",latLong:$latlng+"",icon:jQuery("#draggable").attr("src"),pinTitle:"",small:jQuery("#small").val(),medium:jQuery("#medium").val(),large:jQuery("#large").val(),pinSettingsXML:"",pinHTML:a,pinText:b,mapID:$mapID},success:function(c){easy2map_imgmappin_functions.retrieveMapPoints();$selectedPin=null},error:function(c,e,d){alert(d);notBusy()}})},setCurrentPosition:function(c,b){var a=new google.maps.LatLng(c,b);$latlng=a},setMapPinImage:function(a){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{MapID:$mapID,PinImage:encodeURIComponent(jQuery(a).attr("src")),action:"e2m_img_save_default_pin_image"},success:function(b){jQuery("#draggable").attr("src",jQuery(a).attr("src"));jQuery("#mapPinIconList").modal("hide");$mapSettings.DefaultPinImage=b;setPinImage(a)},error:function(b,d,c){alert(c)}})},SetPinPosition:function(e,c){var a=new google.maps.LatLng(e,c);$latlng=a;if($selectedPin==null){easy2map_imgmappin_functions.placePin(a,true);$map.setCenter(a);$map.setZoom(parseInt(jQuery("#markerZoom").val()));var d=jQuery.xml2json($mapSettings.Settings);d.lattitude=e;d.longitude=c;d.zoom=$map.getZoom();var b={formatOutput:true,rootTagName:"settings"};$mapSettings.Settings=jQuery.json2xml(d,b)}else{$selectedPin.setPosition(a)}setTimeout("jQuery('#address').val('')",1500)},setIconDraggable:function(){jQuery("#draggable").css("cursor","move");jQuery("#draggable").draggable({appendTo:"#bodyTag",scroll:false,helper:"clone",stop:function(h){var g=$map.getBounds();var d=g.getSouthWest();var c=g.getNorthEast();var b=jQuery("#divMap").offset();var a=new google.maps.Point(h.pageX-b.left,h.pageY-b.top+22);var f=$overlay.getProjection().fromContainerPixelToLatLng(a);if(d.lng()>0&&(f.lng()>0&&f.lng()<d.lng())){return}if(d.lng()<0&&(f.lng()<0&&f.lng()<d.lng())){return}if(c.lng()>0&&(f.lng()>0&&f.lng()>c.lng())){return}if(c.lng()<0&&(f.lng()<0&&f.lng()>c.lng())){return}easy2map_imgmappin_functions.placePin(f)}})},setIconNotDraggable:function(){jQuery("#draggable").css("cursor","default").draggable("destroy")},uploadPinIcon:function(){var a=checkFileExtensionSilent(document.getElementById("pinicon"));if(a!=""){alert("Invalid file, only the following image types are allowed: "+a+". Please upload a different image.");return}document.formAddPinIcon.submit()},uploadPinPicture:function(){if(document.getElementById("pinimage").value===""){return}var a=true;var b=checkFileExtensionSilent(document.getElementById("pinimage"));if(b!=""){alert("Invalid file, only the following image types are allowed: "+b+". Please upload a different image.");a=false;return}if(a==true){busy();document.formAddPinImage.submit()}}}})();